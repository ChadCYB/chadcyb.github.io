(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{539:function(a,s,e){"use strict";e.r(s);var t=e(6),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[e("img",{attrs:{src:"https://i.imgur.com/8xF4SUW.jpg",alt:""}})]),a._v(" "),e("h2",{attrs:{id:"what-is-harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-harbor"}},[a._v("#")]),a._v(" What is Harbor?")]),a._v(" "),e("p",[a._v("Harbor is an open source registry that secures artifacts with policies and role-based access control, ensures images are scanned and free from vulnerabilities, and signs images as trusted. Harbor, a CNCF Graduated project, delivers compliance, performance, and interoperability to help you consistently and securely manage artifacts across cloud native compute platforms like Kubernetes and Docker.")]),a._v(" "),e("h2",{attrs:{id:"harbor-installation-rrerequisites"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#harbor-installation-rrerequisites"}},[a._v("#")]),a._v(" Harbor Installation Rrerequisites")]),a._v(" "),e("p",[a._v("The target host requires Docker, and Docker Compose to be installed.")]),a._v(" "),e("p",[a._v("Please refer to the installation instruction of "),e("a",{attrs:{href:"https://cyb.tw/docs/Tech/2020/8/Install%20Docker%20Dockerhub%20and%20docker%20compose%20on%20Ubuntu.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("this article"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("h2",{attrs:{id:"download-and-unpack-the-installer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#download-and-unpack-the-installer"}},[a._v("#")]),a._v(" Download and Unpack the Installer")]),a._v(" "),e("ol",[e("li",[a._v("Download the installer form "),e("a",{attrs:{href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("Harbor release page"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("unpack the installer:")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf harbor-online-installer-version.tgz\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## or")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf harbor-offline-installer-version.tgz\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h2",{attrs:{id:"configure-https-access-to-harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-https-access-to-harbor"}},[a._v("#")]),a._v(" Configure HTTPS Access to Harbor")]),a._v(" "),e("ol",[e("li",[a._v("Generate a Certificate Authority Certificate")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Generate a CA certificate private key")]),a._v("\nopenssl genrsa -out ca.key "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Generate the CA certificate")]),a._v("\nopenssl req -x509 -new -nodes -sha512 -days "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3650")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n -subj "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/C=TW/ST=Taipei/L=Taipei/O=example/OU=Personal/CN=yourdomain.com"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n -key ca.key "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n -out ca.crt\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[a._v("Generate a Server Certificate")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Generate a private key")]),a._v("\nopenssl genrsa -out yourdomain.com.key "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Generate a certificate signing request (CSR)")]),a._v("\nopenssl req -sha512 -new "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -subj "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/C=TW/ST=Taipei/L=Taipei/O=example/OU=Personal/CN=yourdomain.com"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -key yourdomain.com.key "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -out yourdomain.com.csr\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Generate an x509 v3 extension file.")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" v3.ext "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=yourdomain.com\nDNS.2=yourdomain\nDNS.3=hostname\nEOF")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[a._v("Use the "),e("code",[a._v("v3.ext")]),a._v(" file to generate a certificate for your Harbor host.")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl x509 -req -sha512 -days "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3650")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -extfile v3.ext "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -CA ca.crt -CAkey ca.key -CAcreateserial "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -in yourdomain.com.csr "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -out yourdomain.com.crt\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[a._v("Copy the server certificate and key into the certficates folder on your Harbor host.")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" yourdomain.com.crt /data/cert/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" yourdomain.com.key /data/cert/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("ol",{attrs:{start:"6"}},[e("li",[a._v("Convert "),e("code",[a._v("yourdomain.com.crt")]),a._v(" to "),e("code",[a._v("yourdomain.com.cert")]),a._v(", for use by Docker.")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl x509 -inform PEM -in yourdomain.com.crt -out yourdomain.com.cert\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"7"}},[e("li",[a._v("Copy the server certificate, key and CA files into the Docker certificates folder on the Harbor host. You must create the appropriate folders first.")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" yourdomain.com.cert /etc/docker/certs.d/yourdomain.com/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" yourdomain.com.key /etc/docker/certs.d/yourdomain.com/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" ca.crt /etc/docker/certs.d/yourdomain.com/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("blockquote",[e("p",[a._v("If you mapped the default nginx port 443 to a different port, create the folder "),e("code",[a._v("/etc/docker/certs.d/yourdomain.com:port")]),a._v(", or "),e("code",[a._v("/etc/docker/certs.d/harbor_IP:port")]),a._v(".")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("/etc/docker/certs.d/\n    └── yourdomain.com:port\n       ├── yourdomain.com.cert  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-- Server certificate signed by CA\n       ├── yourdomain.com.key   "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-- Server key signed by CA\n       └── ca.crt               "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-- Certificate authority that signed the registry certificate\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("ol",{attrs:{start:"8"}},[e("li",[a._v("Restart Docker Engine")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart docker\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"configure-the-harbor-yml-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-harbor-yml-file"}},[a._v("#")]),a._v(" Configure the Harbor YML File")]),a._v(" "),e("ol",[e("li",[a._v("Copy "),e("code",[a._v("harbor.yml.tmpl")]),a._v(" to "),e("code",[a._v("harbor.yml")])])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" harbor.yml.tmpl harbor.yml\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("Edit and config the "),e("code",[a._v("harbor.yml")]),a._v(" file")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" harbor.yml\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("Go "),e("a",{attrs:{href:"https://goharbor.io/docs/2.2.0/install-config/configure-yml-file/",target:"_blank",rel:"noopener noreferrer"}},[a._v("here"),e("OutboundLink")],1),a._v(" to read the configuration detail.")]),a._v(" "),e("h2",{attrs:{id:"deploy-or-reconfigure-harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy-or-reconfigure-harbor"}},[a._v("#")]),a._v(" Deploy or Reconfigure Harbor")]),a._v(" "),e("p",[a._v("Run the script to deploy harbor. Note that it might take some time for the online installer to download all of the Harbor images from Docker hub.")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Run the prepare script to enable HTTPS.")]),a._v("\n./prepare\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## install and start Harbor")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" ./install.sh --with-notary --with-clair\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("h2",{attrs:{id:"how-to-restart-the-harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-restart-the-harbor"}},[a._v("#")]),a._v(" How to restart the Harbor")]),a._v(" "),e("p",[a._v("If the Harbor service occur error, you can try to restart it. Your image data remains in the file system, so no data is lost.")]),a._v(" "),e("ul",[e("li",[a._v("Stop Harbor")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker-compose down -v\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("Restart Harbor")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("docker-compose up -d\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"references"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[a._v("#")]),a._v(" References")]),a._v(" "),e("ul",[e("li",[a._v("https://goharbor.io/docs/2.2.0/install-config/")]),a._v(" "),e("li",[a._v("https://ithelp.ithome.com.tw/articles/10223099")]),a._v(" "),e("li",[a._v("https://ithelp.ithome.com.tw/articles/10249640")]),a._v(" "),e("li",[a._v("https://randyou.github.io/2020/07/07/gitlab-jenkins-harbor-k8s/")])])])}),[],!1,null,null,null);s.default=r.exports}}]);