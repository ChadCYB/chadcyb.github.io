(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{524:function(e,s,a){"use strict";a.r(s);var t=a(6),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("We often encounter all kinds of network architectures, Some are simply connected directly, some are behind other machines, and some are blocked by firewall that can't easily access it. This article show how to use ssh to connect in various situations.")]),e._v(" "),a("h2",{attrs:{id:"local-port-forwarding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#local-port-forwarding"}},[e._v("#")]),e._v(" Local Port Forwarding")]),e._v(" "),a("ul",[a("li",[e._v("Situation:\n"),a("ul",[a("li",[a("strong",[e._v("access "),a("code",[e._v("remote server's network")]),e._v(" on"),a("code",[e._v("loaclhost")])])]),e._v(" "),a("li",[e._v("only "),a("code",[e._v("localhost")]),e._v(" can acees "),a("code",[e._v("remote server")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("localhost --ssh--\x3e remote server")])]),e._v(" "),a("li",[a("code",[e._v("localhost <--X-- remote server")])])])])])])]),e._v(" "),a("h3",{attrs:{id:"command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command"}},[e._v("#")]),e._v(" Command")]),e._v(" "),a("p",[e._v("Run following command on "),a("strong",[e._v("localhsot")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -L <local_port>:<target> <remote_server>\n## Run in background\nssh -NfL <local_port>:<target> <remote_server>\n## With ssh key\nssh -i <key_path> -NfL <local_port>:<target> <remote_server>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ul",[a("li",[e._v("All traffic sent to "),a("code",[e._v("localhost:<local_port>")]),e._v(" will be tunneled to "),a("code",[e._v("<target>")]),e._v(" thought your "),a("code",[e._v("<remote_server>")]),e._v(".")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("localhost:<local_port> --\x3e <remote_server> --\x3e <target>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"example-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-1"}},[e._v("#")]),e._v(" Example 1")]),e._v(" "),a("p",[e._v("access remote server 22 port thought localhost 1022")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("localhsot:1022 --\x3e user@192.168.90.1 --\x3e 192.168.90.1:22\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("Command")])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -NfL 1022:192.168.90.1:22 user@192.168.90.1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("Now you can access remote server thought localhost:1022")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh user@localhost -p 1022\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"example-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-2"}},[e._v("#")]),e._v(" Example 2")]),e._v(" "),a("p",[e._v("access office web server(192.168.90.100) 80 port thought localhost 8080")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("localhsot:8080 --\x3e user@192.168.90.1 --\x3e 192.168.90.100:80\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("Command")])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -NfL 8080:192.168.90.1:80 user@192.168.90.1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("Now you can access office web server by browsing "),a("code",[e._v("http://localhost:8080")]),e._v(".")]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"remote-port-forwarding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remote-port-forwarding"}},[e._v("#")]),e._v(" Remote Port Forwarding")]),e._v(" "),a("ul",[a("li",[e._v("Situation:\n"),a("ul",[a("li",[a("strong",[e._v("access "),a("code",[e._v("loaclhost's network")]),e._v(" on "),a("code",[e._v("remote server")])])]),e._v(" "),a("li",[e._v("only "),a("code",[e._v("localhost")]),e._v(" can acees "),a("code",[e._v("remote server")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("localhost --ssh--\x3e remote server")])]),e._v(" "),a("li",[a("code",[e._v("localhost <--X-- remote server")])])])])])])]),e._v(" "),a("h3",{attrs:{id:"command-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-2"}},[e._v("#")]),e._v(" Command")]),e._v(" "),a("p",[e._v("Run following command on "),a("strong",[e._v("localhost")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -R <remote_port>:<target> <remote_server>\n## Run in background\nssh -NfR <remote_port>:<target> <remote_server>\n## With ssh key\nssh -i <key_path> -NfR <remote_port>:<target> <remote_server>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ul",[a("li",[e._v("All traffic sent to "),a("code",[e._v("<remote_server>:<remote_port>")]),e._v(" will be tunneled to "),a("code",[e._v("<target>")]),e._v(" thought "),a("code",[e._v("localhost")]),e._v(".")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<remote_server>:<remote_port> --\x3e localhost --\x3e <target>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"example-1-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-1-2"}},[e._v("#")]),e._v(" Example 1")]),e._v(" "),a("p",[e._v("access localhost ssh thoght remote server 1022 port")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("192.168.90.1:1022 -> localhsot --\x3e localhsot:22\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("Command")])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("## type on localhost\nssh -NfR 1022:localhost:22 user@192.168.90.1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Now you can access localhost ssh on remote server thought localhost:1022")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("## type on remote server\nssh user@localhost -p 1022\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"example-2-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-2-2"}},[e._v("#")]),e._v(" Example 2")]),e._v(" "),a("p",[e._v("access local proxy server "),a("code",[e._v("192.168.1.100:3128")]),e._v(" thought remote server "),a("code",[e._v("192.168.90.1:1234")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("192.168.90.1:1234 -> localhsot --\x3e 192.168.1.100:3128\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("Command")])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("## type on localhost\nssh -NfR 1234:192.168.90.100:3128 user@192.168.90.1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("Now you can set up proxy on "),a("code",[e._v("localhost:1234")]),e._v(" on remote server.")]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"dynamic-port-forwarding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-port-forwarding"}},[e._v("#")]),e._v(" Dynamic Port Forwarding")]),e._v(" "),a("ul",[a("li",[e._v("SSH SOCKS Server")]),e._v(" "),a("li",[e._v("Pass all traffic thought SOCKS Server")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("localhost ==-all traffic-==> remote server ==> internet\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"command-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-3"}},[e._v("#")]),e._v(" Command")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -D 8080 user@remote.server\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"example-1-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-1-3"}},[e._v("#")]),e._v(" Example 1")]),e._v(" "),a("ul",[a("li",[e._v("Proxy the remote server's traffic thought localhost's network")]),e._v(" "),a("li",[e._v("Remote server cant access internet")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Proxy Server: localhost:54321\nRemote Server: 192.168.90.1\n\n192.168.90.1:54321 --ssh tunnel--\x3e localhost:54321 ==> internet\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("## Create proxy server on localhost:54321\nssh -i /home/ubuntu/key.pem -f -N -D 54321 localhost\n## Create a resever ssh to remote server\nssh -fNCR 54321:localhost:54321 user@192.168.90.1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("ul",[a("li",[a("code",[e._v("-C")]),e._v(" means compress the traffic")]),e._v(" "),a("li",[a("code",[e._v("-fN")]),e._v(" run in background")]),e._v(" "),a("li",[a("code",[e._v("-D")]),e._v(" create proxy server")]),e._v(" "),a("li",[a("code",[e._v("-R")]),e._v(" create reverse tunnel")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"executing-a-command-on-remote-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#executing-a-command-on-remote-server"}},[e._v("#")]),e._v(" Executing a command on remote server")]),e._v(" "),a("ul",[a("li",[e._v("Easy for write in shell scirpt when you need runing command on remote server.")])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh <user>@<remote_server> -- <command>\n\n## get remote server's apache error log\nssh user@192.168.9.1 -- cat /var/log/apache2/error.log | grep error | tee remote.server.apache2.log\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("hr"),e._v(" "),a("h2",{attrs:{id:"postscript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postscript"}},[e._v("#")]),e._v(" Postscript")]),e._v(" "),a("h3",{attrs:{id:"check-ports-in-use-linux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check-ports-in-use-linux"}},[e._v("#")]),e._v(" check ports in use linux")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo netstat -tulpn | grep LISTEN\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"kill-the-ssh-seesion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kill-the-ssh-seesion"}},[e._v("#")]),e._v(" kill the ssh seesion")]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo ps aux | grep ssh\n\nkill <PID>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"create-ssh-session-without-occupy-a-tty"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-ssh-session-without-occupy-a-tty"}},[e._v("#")]),e._v(" Create ssh session without occupy a tty")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("-nNT")])])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssh -nNT -L 9000:imgur.com:80 user@example.com\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("Arguments explained\n"),a("ul",[a("li",[a("code",[e._v("-n")]),e._v(" Redirects stdin from /dev/null (actually, prevents reading from stdin). This must be used when ssh is run in the background.")]),e._v(" "),a("li",[a("code",[e._v("-N")]),e._v(" Do not execute a remote command. This is useful for just forwarding ports (protocol version 2 only).")]),e._v(" "),a("li",[a("code",[e._v("-T")]),e._v(" Disable pseudo-terminal allocation.")])])])]),e._v(" "),a("h2",{attrs:{id:"reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://70tw.blogspot.com/2010/10/linux-ssh-tunnel-vpn.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("反向建立 SSH Tunnel、免 VPN 連回公司"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://myapollo.com.tw/zh-tw/ssh-port-forwarding/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH Port Forwarding / Agent Forwarding"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://yu-jack.github.io/2019/01/08/ssh-tunnel/",target:"_blank",rel:"noopener noreferrer"}},[e._v("關於 SSH Tunnel 連線"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.howtogeek.com/168145/how-to-use-ssh-tunneling/",target:"_blank",rel:"noopener noreferrer"}},[e._v("how to use ssh tunneling"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://gist.github.com/FMCorz/6f84985f96c5c7f9f4c9a73f31f79d21",target:"_blank",rel:"noopener noreferrer"}},[e._v("gist - Port forwarding using SSH"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://dev.to/mrkaran/using-sshtunnel-2h24",target:"_blank",rel:"noopener noreferrer"}},[e._v("sshuttle - A better ssh tunnel"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language-bash= line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sshuttle --dns --vr ubuntu@localhost 0/0 --ssh-cmd 'ssh -i ~/dct_key/dct.pem -p 10022'\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);